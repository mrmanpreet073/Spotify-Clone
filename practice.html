<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music </title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;

    }

    body {
        color: white;
        background-color: #201f1f;
    }

    .music-container {
        text-align: center;
        /* border: 2px solid black; */
        height: 70vh;
    }

    .card {
        /* display: flex; */
        margin: auto;
        align-items: center;
        justify-content: center;
        justify-content: center;
        /* border: 2px solid green; */
        background-color: #323232;
        width: 90vw;
        max-height: 300px;
        overflow-y: scroll;
    }

    ul li img {
        padding: 5px;
        height: 40px;
    }

    ul li {
        /* border: 2px solid red; */
        background-color: #7c3f3f;
        margin: 15px;
        gap: 10px;
        border-radius: 5px;
        display: flex;
        white-space: nowrap;
        align-items: center;

    }

    .play-area2 {
        display: flex;
        align-items: center;
        justify-content: space-around;
    }

    .play-area {
        position: absolute;
        background-color:  rgb(0, 0, 0);
        bottom: 0;
        width: 100vw;

    }

    .seekbar {
        margin: 10px;
    }

    .line {
        position: relative;
        border: 1px solid white;
        width: 60vw;
        height: 5px;
        margin: auto;
        border-radius: 10px;

    }

    .circle {
        position: absolute;
        border: 3px solid white;
        width: 5px;
        border-radius: 20px;

    }

    .buttons {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
    }
</style>

<body>
    <div class="music-container">
        <h1>All Music</h1>
        <div class="card">
            <ul class="ull">

            </ul>
        </div>
    </div>

    <div class="play-area">
        <div class="play-area2">
            <div class="song-name"></div>
            <div class="buttons">
                <img src="img/previous.svg" alt="">
                <img class="play" src="img/play.svg" alt="">
                <img src="img/next.svg" alt="">
            </div>
            <div class="duration">00:00 / 00:00</div>
        </div>
        <div class="seekbar">
            <div class="line">
                <div class="circle"></div>
            </div>

        </div>
    </div>
    <script>
        let audio = new Audio();
        let play = document.querySelector('.play');
        let playarea = document.querySelector('.play-area2')
// All Functions  

//Play Music
        let playmusic = (track) => {

            audio.src = track;
            if (audio.paused) {
                audio.play();
                play.src = 'img/pause.svg'

            }


        };
//Formate Time
function formatTime(seconds) {
  if (isNaN(seconds)) return "0:00"; // handle NaN or invalid input
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs < 10 ? "0" : ""}${secs}`;
}

        console.log('Starting JS');

        async function fetchdata() {
            let response = await fetch('music/sidhu');
            let result = await response.text();
            let div = document.createElement('div');
            div.innerHTML = result;
            let as = div.getElementsByTagName('a')
            let songs = [];

            for (let index = 0; index < as.length; index++) {
                const e = as[index];
                if (e.href.endsWith('.mp3')) {
                    songs.push(e.href.split('sidhu/')[1].replaceAll('%20', ' '));


                }

            }
            // adding songs  
            for (const song of songs) {
                let songul = document.querySelector('.ull');
                songul.innerHTML = songul.innerHTML + `
                  <li>
                    <div><img class="invert" src="img/play.svg" alt=""></div>
                    <div class="sname">${song}</div>
                    <div></div>
                </li>`;


            }
            // Add event listner to all songs  
            Array.from(document.getElementsByTagName('li')).forEach((e) => {

                e.addEventListener('click', () => {

                    playmusic("music/sidhu/" + e.querySelector('.sname').innerHTML);

let value=e.querySelector('.sname').innerHTML;
let songname=document.querySelector('.song-name');
songname.innerHTML=value;


                })


            });
            // Working onn play Button 
            play.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play();
                    play.src = 'img/pause.svg';
                }
                else {
                    audio.pause();
                    play.src = 'img/play.svg'
                }
            });

            // Working on song duration 

            audio.addEventListener('timeupdate',()=> {

                // console.log(formatTime(audio.duration))
                // console.log(formatTime(audio.currentTime))
                document.querySelector('.duration').innerHTML=`${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
              
            });

            

        }

        fetchdata();


    </script>
</body>

</html>